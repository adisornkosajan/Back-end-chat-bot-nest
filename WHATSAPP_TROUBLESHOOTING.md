# WhatsApp ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ - ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

## üîç ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö

‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏à‡∏≠‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å 3 ‡∏Ç‡πâ‡∏≠:

1. **Invalid webhook payload** - Webhook ‡∏à‡∏≤‡∏Å WhatsApp ‡∏ö‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å handle
2. **Platform not found** - Phone Number ID ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏ß‡πâ
3. **‡πÑ‡∏°‡πà‡∏°‡∏µ error logs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á** - ‡∏ã‡∏∂‡πà‡∏á‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏™‡πà‡∏á‡πÄ‡∏•‡∏¢

## ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß

### 1. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á WhatsApp Webhook Handler
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ handle status webhooks (delivered, read, sent)
- ‡πÄ‡∏û‡∏¥‡πà‡∏° debug logging ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π webhook structure
- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á error messages ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô

### 2. ‡πÄ‡∏û‡∏¥‡πà‡∏° Error Handling ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö WhatsApp
- ‡πÅ‡∏™‡∏î‡∏á error codes ‡πÅ‡∏•‡∏∞ messages ‡∏ó‡∏µ‡πà‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
- ‡πÅ‡∏õ‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ error codes ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ:
  - **190**: Access Token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‚Üí ‡∏ï‡πâ‡∏≠‡∏á reconnect
  - **131030/131031**: ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ú‡∏¥‡∏î ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö format
  - **100**: Parameter ‡∏ú‡∏¥‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ permission
  - **80007**: ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ template

## üîß ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Configuration

```bash
# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ WhatsApp platform ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
node check-whatsapp.js
```

**‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ:**
```json
{
  "pageId": "939524039244168",  // Phone Number ID
  "phoneNumberId": "939524039244168",  // ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô
  "displayPhoneNumber": "15551600963"
}
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

```bash
# ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå test-whatsapp-send.js
# ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô testPhoneNumber ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÄ‡∏ä‡πà‡∏ô '66812345678')
node test-whatsapp-send.js
```

## üêõ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Access Token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (Error 190)

**‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:**
```
WhatsApp API Error - Code: 190
Message: Invalid OAuth access token
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ Connections ‡πÉ‡∏ô Dashboard
2. Disconnect WhatsApp
3. Connect ‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Phone Number ID ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô

**‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:**
```
Platform not found: whatsapp with recipientId: 123456123
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Phone Number ID ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:
   ```bash
   node check-whatsapp.js
   ```
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ webhook URL ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:
   ```
   https://your-domain.com/api/webhooks/whatsapp
   ```
3. ‡πÉ‡∏ô Meta App Dashboard ‚Üí WhatsApp ‚Üí Configuration:
   - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ webhook subscription ‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà
   - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Phone Number ID ‡∏ï‡∏£‡∏á

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ (Error 80007)

**‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:**
```
24-hour messaging window has expired
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
- ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î 24-hour window)
- ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Message Templates ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å Meta

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Invalid recipient (Error 131030/131031)

**‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:**
```
Invalid WhatsApp recipient phone number
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö format ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:
   - ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ country code (‡πÄ‡∏ä‡πà‡∏ô `66812345678` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ó‡∏¢)
   - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ + ‡∏´‡∏£‡∏∑‡∏≠ 0 ‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏µ WhatsApp ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
3. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô test number ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô Meta App ‚Üí WhatsApp ‚Üí Phone Numbers ‚Üí Test Numbers

## üìä ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Logs

```bash
# ‡∏î‡∏π logs ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
Get-Content "logs\talk-v-2026-02-16.log" -Tail 50 | Select-String "whatsapp"

# ‡∏î‡∏π error logs
Get-Content "logs\talk-v-2026-02-16.log" | Select-String "WHATSAPP Send Error"
```

## üîÑ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£ Debug ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î

### 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ Webhook ‡∏°‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
‡∏î‡∏π‡πÉ‡∏ô logs ‡∏ß‡πà‡∏≤‡∏°‡∏µ:
```
"Webhook received from WHATSAPP"
```

### 2. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ parse ‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
‡∏ñ‡πâ‡∏≤‡πÄ‡∏´‡πá‡∏ô:
```
"Invalid WhatsApp webhook payload structure"
```
‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô status webhook (‡∏õ‡∏Å‡∏ï‡∏¥, ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ)

### 3. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏™‡πà‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô inbound message ‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô:
```
"Processing inbound message from whatsapp"
```

### 4. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠ error:
```
"WHATSAPP Send Error"
```
‡∏î‡∏π error code ‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô

## üìù Checklist ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô WhatsApp

- [ ] WhatsApp Business API setup ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
- [ ] Phone Number verified ‡πÅ‡∏•‡πâ‡∏ß
- [ ] Access Token ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ (‡πÑ‡∏°‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏)
- [ ] Webhook URL ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô Meta Dashboard
- [ ] Webhook verify token ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö `META_WEBHOOK_VERIFY_TOKEN` ‡πÉ‡∏ô .env
- [ ] App Secret ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô `META_APP_SECRET`
- [ ] Phone Number ID ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- [ ] Test ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢ `test-whatsapp-send.js` ‡∏ú‡πà‡∏≤‡∏ô

## üîó Links ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå

- [WhatsApp Business Platform API Docs](https://developers.facebook.com/docs/whatsapp/cloud-api)
- [Error Codes Reference](https://developers.facebook.com/docs/whatsapp/cloud-api/support/error-codes)
- [Webhook Reference](https://developers.facebook.com/docs/whatsapp/cloud-api/webhooks)
- [24-Hour Window Policy](https://developers.facebook.com/docs/whatsapp/messaging-limits)

## üÜò ‡∏¢‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ?

1. ‡πÄ‡∏õ‡∏¥‡∏î Prisma Studio ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:
   ```bash
   npx prisma studio
   ```
   - ‡πÄ‡∏ä‡πá‡∏Ñ Platform table ‚Üí type = whatsapp
   - ‡πÄ‡∏ä‡πá‡∏Ñ pageId ‡πÅ‡∏•‡∏∞ accessToken

2. ‡∏•‡∏≠‡∏á disconnect ‡πÅ‡∏•‡πâ‡∏ß connect ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô Dashboard

3. ‡∏•‡∏≠‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å Dashboard ‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏π logs:
   ```bash
   Get-Content "logs\talk-v-2026-02-16.log" -Tail 20 -Wait
   ```

4. ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πá‡∏Ñ Meta App Dashboard ‚Üí WhatsApp ‚Üí Insights
   ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π delivery status ‡πÅ‡∏•‡∏∞ error messages
